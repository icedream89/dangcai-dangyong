<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dangcai.business.mapper.PurchaseMatchMapper">

    <!-- 根据需求ID查询匹配列表 -->
    <select id="selectMatchListByRequirementId" resultType="com.dangcai.business.vo.PurchaseMatchVO">
        SELECT
            id,
            requirement_id,
            enterprise_id,
            enterprise_name,
            operator_id,
            operator_name,
            match_time,
            has_replied,
            status,
            CASE status
                WHEN 1 THEN '已匹配'
                WHEN 2 THEN '已取消'
                ELSE '未知'
            END AS status_name,
            cancel_time,
            cancel_reason
        FROM biz_purchase_match
        WHERE requirement_id = #{requirementId}
        ORDER BY match_time DESC
    </select>

    <!-- 根据需求ID和企业ID查询匹配记录 -->
    <select id="selectByRequirementIdAndEnterpriseId" resultType="com.dangcai.business.domain.PurchaseMatch">
        SELECT
            id,
            requirement_id,
            enterprise_id,
            enterprise_name,
            operator_id,
            operator_name,
            match_time,
            has_replied,
            status,
            cancel_time,
            cancel_reason
        FROM biz_purchase_match
        WHERE requirement_id = #{requirementId}
          AND enterprise_id = #{enterpriseId}
          AND status = 1
    </select>

    <!-- 查询需求匹配的企业ID列表 -->
    <select id="selectMatchedEnterpriseIds" resultType="java.lang.Long">
        SELECT enterprise_id
        FROM biz_purchase_match
        WHERE requirement_id = #{requirementId} AND status = 1
    </select>

</mapper>
